<?php
/**
* MalwarescanStatus View para el Componente Securitycheckpro
* @ author Jose A. Luque
* @ Copyright (c) 2011 - Jose A. Luque
* @license GNU/GPL v2 or later http://www.gnu.org/licenses/gpl-2.0.html
*/
// Chequeamos si el archivo está incluido en Joomla!
defined('_JEXEC') or die();
jimport( 'joomla.application.component.view' );
jimport( 'joomla.plugin.helper' );

class SecuritycheckprosViewMalwarescanStatus extends JViewLegacy{

protected $state;
/**
* Securitycheckpros view método 'display'
**/
function display($tpl = null)
{
JToolBarHelper::title( JText::_( 'Securitycheck Pro' ).' | ' .JText::_('COM_SECURITYCHECKPRO_MALWARESCAN_PANEL_TEXT'), 'securitycheckpro' );
JToolBarHelper::custom('redireccion_malwarescan_control_panel','arrow-left','arrow-left','COM_SECURITYCHECKPRO_REDIRECT_MALWARESCAN_CONTROL_PANEL');
JToolBarHelper::custom('manage_online_logs','folder-2 ','folder-2 ','COM_SECURITYCHECKPRO_MANAGE_ONLINE_LOGS');
JToolBarHelper::custom('csv_export', 'out-2', 'out-2', 'COM_SECURITYCHECKPRO_EXPORT_INFO_CSV', false);
JToolBarHelper::custom('delete','delete','delete','COM_SECURITYCHECKPRO_DELETE');
JToolBarHelper::custom('view_file', 'eye-open', 'eye-open', 'COM_SECURITYCHECKPRO_VIEW_FILE');

// Filtro por tipo de extensión
$this->state= $this->get('State');
$malwarescan_search = $this->state->get('filter.malwarescan_search');
$filter_malwarescan_status = $this->state->get('filter.malwarescan_status');

// Establecemos el valor del filtro 'malwarescan_status' a cero para que muestre sólo los archivos sospechosos
if ( $filter_malwarescan_status == ''){
	$this->state->set('filter.malwarescan_status',0);
}

$model = $this->getModel("malwarescanstatus");
$items = $model->loadStack("malwarescan","malwarescan");
$online_checked_files = $model->get_campo_filemanager("online_checked_files");
$online_checked_hashes = $model->get_campo_filemanager("online_checked_hashes");
$show_all = $this->state->get('showall',0);
$database_error = $model->get_campo_filemanager("estado_malwarescan");

// Consultamos los valores de configuración
$params = JComponentHelper::getParams('com_securitycheckpro');
$opswat_key = $params->get('opswat_key','');
$online_submission_type = $params->get('online_submission_type','Hashes');
// Ponemos los datos en el template
$this->assignRef('items', $items);
$this->assignRef('online_checked_files', $online_checked_files);
$this->assignRef('online_checked_hashes', $online_checked_hashes);
$this->assignRef('show_all', $show_all);
$this->assignRef('database_error', $database_error);
$this->assignRef('opswat_key', $opswat_key);
$this->assignRef('online_submission_type', $online_submission_type);

if ( !empty($items) ) {
	$pagination = $this->get('Pagination');
	$this->assignRef('pagination', $pagination);
}

parent::display($tpl);
}
}