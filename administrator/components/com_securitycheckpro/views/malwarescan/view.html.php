<?php
/**
* MalwareScan View para el Componente Securitycheckpro
* @ author Jose A. Luque
* @ Copyright (c) 2011 - Jose A. Luque
* @license GNU/GPL v2 or later http://www.gnu.org/licenses/gpl-2.0.html
*/
// Chequeamos si el archivo está incluido en Joomla!
defined('_JEXEC') or die();
jimport( 'joomla.application.component.view' );
jimport( 'joomla.plugin.helper' );

/**
* FilesIntegrity View
*
*/
class SecuritycheckprosViewMalwareScan extends JViewLegacy{

protected $state;

function display($tpl = null)
{
JToolBarHelper::title( JText::_( 'Securitycheck Pro' ).' | ' .JText::_('COM_SECURITYCHECKPRO_MALWARESCAN'), 'securitycheckpro' );
JToolBarHelper::custom('redireccion_control_panel','arrow-left','arrow-left','COM_SECURITYCHECKPRO_REDIRECT_CONTROL_PANEL');
JToolBarHelper::custom('redireccion_system_info','arrow-left','arrow-left','COM_SECURITYCHECKPRO_REDIRECT_SYSTEM_INFO');

// Obtenemos los datos del modelo
$model = $this->getModel("filemanager");
$last_check_malwarescan = $model->loadStack("malwarescan_resume","last_check_malwarescan");
$files_scanned_malwarescan = $model->loadStack("malwarescan_resume","files_scanned_malwarescan");
$suspicious_files = $model->loadStack("malwarescan_resume","suspicious_files");

$task_ended = $model->get_campo_filemanager("estado_malwarescan");

// Establecemos el tamao mximo de memoria que el script puede consumir
$params = JComponentHelper::getParams('com_securitycheckpro');
$deep_scan_status = $params->get('deep_scan',0);
$online_submission_type = $params->get('online_submission_type','Hashes');
$timeline = $params->get('timeline',7);

if ( $deep_scan_status ) {
	$deep_scan_status = JText::_('COM_SECURITYCHECKPRO_PLUGIN_ENABLED');
} else {
	$deep_scan_status = JText::_('COM_SECURITYCHECKPRO_PLUGIN_DISABLED');
}

// Si no se está ejecutando ninguna tarea, mostramos la opción 'view suspicious files'
if ( strtoupper($task_ended) != 'IN_PROGRESS' ) {
	JToolBarHelper::custom( 'view_files_malwarescan', 'eye-open', 'eye-open', 'COM_SECURITYCHECKPRO_VIEW_SUSPICIOUS_FILES' );
}


// Ponemos los datos en el template
$this->assignRef('last_check_malwarescan', $last_check_malwarescan);
$this->assignRef('files_scanned_malwarescan', $files_scanned_malwarescan);
$this->assignRef('suspicious_files', $suspicious_files); 
$this->assignRef('deep_scan_status', $deep_scan_status);
$this->assignRef('online_submission_type', $online_submission_type);
$this->assignRef('timeline', $timeline);

parent::display($tpl);
}
}